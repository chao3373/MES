<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>销售单据查询</title>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/bootstrap/easyui.css"></link>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            load();
            loaddg();
        });

        function load() {
            $("#dlg").datagrid({
                url: "/admin/saleList/findByState?state=合格入库",
                columns: [[
                    {
                        field: 'cb',
                        checkbox: "true",
                        align: "center"
                    },{
                        field: 'id',
                        title: '编号',
                        width: 100,
                        align: 'center',
                        hidden:'true'
                    }, {
                        field: 'saleNumber',
                        title: '订单号',
                        width: 120,
                        align: 'center'
                    }, {
                        field: 'hangHao',
                        title: '行号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'wuliaoId',
                        title: '物料编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'tuzhiId',
                        title: '图纸编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'tuzhiName',
                        title: '图纸名称',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'xiangmuId',
                        title: '项目编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'shenqingNumber',
                        title: '申请单号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'kucunzuzhi',
                        title: '库存组织',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'state',
                        title: '订单状态',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'prepareTime',
                        title: '准备工时',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'saleDate',
                        title: '销售日期',
                        width: 130,
                        align: 'center',
                        formatter: function (value, row, index) {
                            if (value) {
                                var date = new Date(value);
                                var o = {
                                    "M+": date.getMonth() + 1,                 //月份
                                    "d+": date.getDate(),                    //日
                                    "h+": date.getHours(),                   //小时
                                    "m+": date.getMinutes(),                 //分
                                    "s+": date.getSeconds(),                 //秒
                                    "q+": Math.floor((date.getMonth() + 3) / 3), //季度
                                    "S": date.getMilliseconds()             //毫秒
                                };
                                if (/(y+)/.test("yyyy-MM-dd hh:mm:ss"))
                                    var fmt = "yyyy-MM-dd hh:mm:ss".replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
                                for (var k in o)
                                    if (new RegExp("(" + k + ")").test(fmt))
                                        fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                return fmt;
                            } else {
                                return "";
                            }
                        }
                    },{
                        field: 'referDate',
                        title: '需交日期',
                        width: 130,
                        align: 'center',
                        formatter: function (value, row, index) {
                            if (value) {
                                var date = new Date(value);
                                var o = {
                                    "M+": date.getMonth() + 1,                 //月份
                                    "d+": date.getDate(),                    //日
                                    "h+": date.getHours(),                   //小时
                                    "m+": date.getMinutes(),                 //分
                                    "s+": date.getSeconds(),                 //秒
                                    "q+": Math.floor((date.getMonth() + 3) / 3), //季度
                                    "S": date.getMilliseconds()             //毫秒
                                };
                                if (/(y+)/.test("yyyy-MM-dd hh:mm:ss"))
                                    var fmt = "yyyy-MM-dd hh:mm:ss".replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
                                for (var k in o)
                                    if (new RegExp("(" + k + ")").test(fmt))
                                        fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                return fmt;
                            } else {
                                return "";
                            }
                        }
                    }]]
            });
        }

        function loaddg() {
            $("#dg").datagrid({
                url: "/admin/saleList/findByState?state=准备提货",
                columns: [[
                    {
                        field: 'cb',
                        checkbox: "true",
                        align: "center"
                    },{
                        field: 'id',
                        title: '编号',
                        width: 100,
                        align: 'center',
                        hidden:'true'
                    }, {
                        field: 'saleNumber',
                        title: '订单号',
                        width: 120,
                        align: 'center'
                    }, {
                        field: 'hangHao',
                        title: '行号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'wuliaoId',
                        title: '物料编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'tuzhiId',
                        title: '图纸编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'tuzhiName',
                        title: '图纸名称',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'xiangmuId',
                        title: '项目编号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'shenqingNumber',
                        title: '申请单号',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'kucunzuzhi',
                        title: '库存组织',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'state',
                        title: '订单状态',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'prepareTime',
                        title: '准备工时',
                        width: 100,
                        align: 'center'
                    }, {
                        field: 'saleDate',
                        title: '销售日期',
                        width: 130,
                        align: 'center',
                        formatter: function (value, row, index) {
                            if (value) {
                                var date = new Date(value);
                                var o = {
                                    "M+": date.getMonth() + 1,                 //月份
                                    "d+": date.getDate(),                    //日
                                    "h+": date.getHours(),                   //小时
                                    "m+": date.getMinutes(),                 //分
                                    "s+": date.getSeconds(),                 //秒
                                    "q+": Math.floor((date.getMonth() + 3) / 3), //季度
                                    "S": date.getMilliseconds()             //毫秒
                                };
                                if (/(y+)/.test("yyyy-MM-dd hh:mm:ss"))
                                    var fmt = "yyyy-MM-dd hh:mm:ss".replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
                                for (var k in o)
                                    if (new RegExp("(" + k + ")").test(fmt))
                                        fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                return fmt;
                            } else {
                                return "";
                            }
                        }
                    },{
                        field: 'referDate',
                        title: '需交日期',
                        width: 130,
                        align: 'center',
                        formatter: function (value, row, index) {
                            if (value) {
                                var date = new Date(value);
                                var o = {
                                    "M+": date.getMonth() + 1,                 //月份
                                    "d+": date.getDate(),                    //日
                                    "h+": date.getHours(),                   //小时
                                    "m+": date.getMinutes(),                 //分
                                    "s+": date.getSeconds(),                 //秒
                                    "q+": Math.floor((date.getMonth() + 3) / 3), //季度
                                    "S": date.getMilliseconds()             //毫秒
                                };
                                if (/(y+)/.test("yyyy-MM-dd hh:mm:ss"))
                                    var fmt = "yyyy-MM-dd hh:mm:ss".replace(RegExp.$1, (date.getFullYear() + "").substr(4 - RegExp.$1.length));
                                for (var k in o)
                                    if (new RegExp("(" + k + ")").test(fmt))
                                        fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                                return fmt;
                            } else {
                                return "";
                            }
                        }
                    }]]
            });
        }

        function zhunbei() {
            var rows = $("#dlg").datagrid("getSelections");
            var strIds =[];
            for (var i = 0;i < rows.length; i++){
                strIds.push(rows[i].id);
            }
            var ids = strIds.join(",");
            $.ajax({
                url:"/admin/saleList/setStateByIds",
                data:{Ids:ids,state:"准备提货"},
                async:false,
                success:function (result) {
                    if(result.success){
                        window.location.reload();
                    }
                }
            })

        }

        function out() {
            var rows = $("#dg").datagrid("getSelections");
            var strIds =[];
            for (var i = 0;i < rows.length; i++){
                strIds.push(rows[i].id);
            }
            var ids = strIds.join(",");
            $.messager.confirm("系统提示","您确定要将这些产品提货吗",function (r) {
                if(r){
                    $.ajax({
                        url:"/admin/saleList/setStateByIds",
                        data:{Ids:ids,state:"提货"},
                        async:false,
                        success:function (result) {
                            if(result.success){
                                window.location.reload();
                            }
                        }
                    })
                }
            })
        }

        //打开任务选择对话框
        function openRoleAddDialog() {
            $("#dlg-main").dialog("open").dialog("setTitle", "任务选择");
        }

        function sumweight() {
            var selectedRows = $("#dd1").datagrid("getSelections");
            console.log(selectedRows);
        }

        function refresh() {

        }

        function search() {
            $("#yaoqiu").val("1");
            $("#fm").form('submit', {
                url: "/admin/saleList/dingDanZhuiZong",
                success: function (result) {
                    if (result != null) {
                        var obj = eval('(' + result + ')');
                        if (obj.success) {
                            $("#dlg").datagrid("loadData", obj.rows);
                        }
                    }
                }
            });
        }
    </script>
</head>
<body class="easyui-layout">
<!--主界面-->
<div data-options="region:'north'" style="padding: 10px; border: 1px">
    <form id="fm1" method="post">
        <table cellspacing="8px">
            <tr>
                <td width="180px">&nbsp;&nbsp;盘点机：<input
                        class="easyui-combobox" id="pandianji" name="pandianji"
                        style="width: 100px"
                        data-options="panelHeight:'auto',valueField:'pid',textField:'name',url:'/admin/pandianji/pandianjiList'"/>
                </td>
                <td><a href="javascript:openRoleAddDialog()"
                       class="easyui-linkbutton" iconCls="icon-add" plain="true">添加出库商品</a>
                </td>
            </tr>
        </table>
    </form>
</div>
<div data-options="region:'center'"
     style="padding: 10px; border: 1px">
    <table id="dg" class="easyui-datagrid" rownumbers="true" fit="true" toolbar="#top">
    </table>
</div>

<!-- 顶部工具栏 -->
<div id="top">
    <div style="padding: 2px">
        &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:out()" class="easyui-linkbutton" plain="true">提货</a>
    </div>
</div>

<!-- 弹出的框 -->
<div class="easyui-dialog" id="dlg-main"  fit="true" closed="true">
    <table id="dlg" class="easyui-datagrid" fitColumns="false"
           rownumbers="true" toolbar="#tb" fit="true">
    </table>
    <!--<div id="tb" style="padding: 15px">
        <div id="tb1" style="margin: 5px">
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:zhunbei()" class="easyui-linkbutton" plain="true">准备出库</a>
            &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:searchRole()" class="easyui-linkbutton"
                                       iconCls="icon-search" plain="true">查询</a>
            &nbsp;&nbsp;&nbsp;&nbsp;合计重量:&nbsp;&nbsp;<input id="sumweight" name="sumweight" style="width: 100px"
                                                            readonly onselect="sumweight()"/>
        </div>
        <div id="tb2" style="margin: 5px">
            <a href="javascript:clertCondition()" class="easyui-linkbutton"
               iconCls="icon-reload">刷新</a>
            &nbsp;&nbsp;&nbsp;&nbsp;合计数量:&nbsp;&nbsp;<input id="sumnum" name="sumnum" style="width: 100px" readonly/>
        </div>
    </div>-->
    <div id="tb" style="padding: 3px;">
        <form id="fm">
            <table>
                <tr>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;订&nbsp;单&nbsp;号： <input name="SaleNumber" id="saleNumber" style="width: 130px"/>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;申请单号： <input name="ShenqingNumber" id="shenqingNumber" style="width: 130px"/>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;项目号： <input name="XiangmuId" id="xiangmuId" style="width: 130px"/>
                    </td>

                    <!--后台需要的yaoqiu的值-->
                    &nbsp;&nbsp;&nbsp;&nbsp;<input type="hidden" name="yaoqiu" id="yaoqiu"/>

                    <td>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:search()"
                                                   class="easyui-linkbutton" iconCls="icon-search">查询</a>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp; 合计数量： <input id="sumnum" name="sumnum" style="width: 100px"
                                                              readonly/>

                    </td>
                </tr>
                <tr>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;图纸编号： <input name="TuzhiId" id="tuzhiId" style="width: 130px"/>
                    </td>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;销售日期： <input type="text" id="aleDate" name="saleDated"
                                                             class="easyui-datebox"
                                                             demandd="true" data-options="editable:false" size="15"/>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;物料号： <input name="WuliaoId" id="wuliaoId" style="width: 130px"/>
                    </td>

                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:refresh()" class="easyui-linkbutton"
                                                   iconCls="icon-reload">刷新</a>
                    </td>
                    <td>
                        &nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:zhunbei()" class="easyui-linkbutton"
                                                   iconCls="icon-redo" plain="true">准备出库</a>
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>

</body>
</html>