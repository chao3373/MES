<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>产品入库</title>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/bootstrap/easyui.css"></link>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            load();
        });

        //大图纸
        function load() {
            $("#dg").datagrid({
                url: '/admin/ruKu/list',
                columns: [[
                    {
                        field: 'cb',
                        checkbox: "true",
                        align: "center"
                    }, {
                        field: "dingdanhao",
                        width: "150",
                        align: "center",
                        title: "销售单号",
                        formatter:function (val, row) {
                            console.log(row)
                            if(row.saleList != null){
                                return row.saleList.saleNumber;
                            }
                            else {
                                return "";
                            }
                        }
                    }, {
                        field: "xiangmuhao",
                        width: "150",
                        align: "center",
                        title: "项目号",
                        formatter: function (val,row ) {
                            if(row.saleList != null){
                                return row.saleList.xiangmuId;
                            }
                            else {
                                return "";
                            }
                        }
                    }, {
                        field: "wuliaohao",
                        width: "150",
                        align: "center",
                        title: "大图",
                        formatter: function (val,row ) {
                            if(row.bigDrawing != null ){
                                return row.bigDrawing.wuliaoId;
                            }
                            else {
                                return "";
                            }
                        }
                    }, {
                        field: "tuzhihao",
                        width: "150",
                        align: "center",
                        title: "小图",
                        formatter: function (val,row ) {
                            if(row.drawing != null){
                                return row.drawing.wuliaoId;
                            }
                            else {
                                return "";
                            }
                        }
                    }, {
                        field: "datuCode",
                        width: "150",
                        align: "center",
                        title: "大图编码"
                    }, {
                        field: "xiaotuCode",
                        width: "150",
                        align: "center",
                        title: "小图编码"
                    }
                ]]
            });
        }

        function ruku() {
            var rows = $("#dg").datagrid("getRows");
            var arr = [];
            for(var i=0;i<rows.length;i++){
                arr.push(rows[i].id);
            }
            var Ids = arr.join(",");

            $.post("/admin/ruKu/ruku",{
                Ids:Ids
            },function (result) {
                if(result.success){
                    $("#dg").datagrid("reload");
                    $.post("/admin/storage/save",{
                        Ids:Ids
                    },function (result) {
                        if(result.success){
                            $.messager.alert("系统提示","入库成功");
                        }else {
                            $.messager.alert("系统提示","入库失败");
                        }
                    })
                }
                else {
                    $.messager.alert("系统提示","入库失败");
                }
            },"json");


        }


    </script>
</head>    <!--上面的dg  下面的addSon-->
<body class="easyui-layout" style="margin: 1px">
<div region="north" style="height: 300px">
    <table id="dg" class="easyui-datagrid"
           fitColumns="false" rownumbers="true" singleSelect="true" fit="true"
           toolbar="#tb1" split="true">
        <thead>
    </table>

    <!-- dg顶部工具栏 -->
    <div id="tb1">
        <fieldset style="border-color: #E7F0FF">
            &nbsp;&nbsp;<a href="javascript:ruku()"
                           class="easyui-linkbutton" iconCls="icon-refresh" plain="true">入库</a>
        </fieldset>
    </div>
</div>


<!--
<div id="dlg" class="easyui-dialog"
     style="width: 400px; height: 200px; padding: 10px 20px" closed="true"
     buttons="#dlg-buttons" data-options="onClose:function(){resetValue()}">
    <form id="fm" method="post" enctype="multipart/form-data">
        <table cellspacing="8px">
            <tr>
                <td valign="top">报废原因：</td>
                <td><textarea rows="4" cols="35" id="remark" name="remark"></textarea>
                </td>
            </tr>
        </table>
    </form>
</div>

<div id="dlg-buttons">
    <a href="javascript:okBaoFei()" class="easyui-linkbutton"
       iconCls="icon-ok">确认报废</a> <a href="javascript:closeDialog()"
                                   class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
</div>
-->



</body>
</html>