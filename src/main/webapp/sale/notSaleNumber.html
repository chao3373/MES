<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>无订单下单分拣</title>
    <link rel="stylesheet" type="text/css" href="/static/jquery-easyui-1.3.3/themes/bootstrap/easyui.css"></link>
    <link rel="stylesheet" type="text/css"
          href="/static/jquery-easyui-1.3.3/themes/icon.css"></link>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/jquery.easyui.min.js"></script>
    <script type="text/javascript"
            src="/static/jquery-easyui-1.3.3/locale/easyui-lang-zh_CN.js"></script>
    <script type="text/javascript" src="/static/js/date.js"></script>
    <script type="text/javascript" src="print.js"></script>
    <script type="text/javascript">
        var url;
        $(document).ready(function () {

        });


        //打开上传文件面板
        function toLead() {
            $("#dlg3").dialog("open").dialog("setTitle", "选择上传文件");
        }

        //提交上传文件
        function saveToLead() {
            $("#fm3").form(
                'submit',
                {
                    url: "/admin/toLead/importFile",
                    onSubmit: function () { //onSubmit  事件会在表单中的确认按钮被点击时发生
                        var fileAccept = $("#fil").val().split(".")[1];
                        if (fileAccept != "xls" && fileAccept != "xlsx") {
                            alert("只能上传.xls和.xlsx的文件！");
                            return false;
                        }
                        return true;
                    },
                    success: function (result) {
                        var obj = eval('(' + result + ')');
                        if (obj.success) {

                        } else {
                            $.messager.alert("系统提示", "<span style='color:red'>"
                                + obj.errorInfo + "</span>");

                        }
                        var resultt = $.parseJSON(result);
                        $("#dg").datagrid({
                            data: resultt.rows
                        });
                    }
                });
            closeToLead();
        }

        //关闭面导入面板
        function closeToLead() {
            $("#dlg3").dialog("close");
        }

        //对比
        function duibi() {
            var row = $("#dg").datagrid("getRows");
            $.ajax({
                type:"post",
                url:"/admin/saleList/notSaleNumber",
                data:{
                    data: JSON.stringify(row)
                },
                dataType:"json",
                success:function (result) {
                    /*if (result.success) {
                        alert("保存成功");
                        window.location.reload();
                    } else {
                        $.messager.alert("系统提示", "保存失败！");
                        return;
                    }*/
                }
            });
        }
    </script>
</head>
<body class="easyui-layout">
<div data-options="region:'center'" style="padding: 10px; border: 1px">
    <table id="dg" class="easyui-datagrid" style="" rownumbers="true"
           singleSelect="true" fit="true" toolbar="#tb">
        <thead>
        <th id="kucunzuzhi" field="kucunzuzhi" width="100" align="center">库存组织</th>
        <th id="hangHao" field="hangHao" width="100" align="center">行号</th>
        <th id="wuliaoId" field="wuliaoId" width="100" align="center">物料编号</th>
        <th id="tuzhiName" field="tuzhiName" width="100" align="center">图纸名称</th>
        <th id="tuzhiId" field="tuzhiId" width="100" align="center">图纸编号</th>
        <th id="num" field="num" width="100" align="center">数量</th>
        <th id="xiangmuId" field="xiangmuId" width="100" align="center">项目号</th>
        <th id="shenqingNumber" field="shenqingNumber" width="100" align="center">申请单号</th>
        <th id="saleNumber" field="saleNumber" width="100" align="center">订单号</th>
        <th id="referDate" field="referDate" width="150" align="center">需交日期</th>
        <th id="saleDate" field="saleDate" width="150" align="center">接单日期</th>
        </thead>
    </table>

    <div id="tb">
        <div style="padding: 2px">
            <input type="hidden" id="goodsJson" name="goodsJson"/>
            <a href="javascript:toLead()" class="easyui-linkbutton"
                iconCls="icon-add" plain="true">导入</a>
            <a href="javascript:duibi()" class="easyui-linkbutton"
                iconCls="icon-ok" plain="true">对比</a>
        </div>
    </div>
</div>


<div id="dlg3" class="easyui-dialog"
     style="width: 400px; height: 180px; padding: 10px 20px" closed="true"
     buttons="#dlg-buttons2"
     data-options="">
    <form id="fm3" method="post" enctype="multipart/form-data"
          action="/admin/toLead/importFile">
        <input id="fil" name="fileName" type="file"/>
    </form>
</div>

<!--导入文件-->
<div id="dlg-buttons2">
    <a href="javascript:saveToLead()" class="easyui-linkbutton"
       iconCls="icon-ok">确定</a> <a href="javascript:closeToLead()"
                                   class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
</div>




</body>
</html>